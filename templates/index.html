<!-- START OF index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lost & Found</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon.png') }}">
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">

<link rel="apple-touch-icon" href="{{ url_for('static', filename='favicon.png') }}">
  <style>
      :root {
    --bs-primary: rgba(0,43,83,1);
    --bs-primary-rgb: 0,43,83;
              --brand-color: rgba(0,43,83,1);
      --brand-hover: #001d3d;
      --found-color: rgba(172,212,241,1);
      --returned-color: rgba(165,179,171,1);
  }
body {
  font-family: "Gill Sans", "Gill Sans MT", Calibri, "Trebuchet MS", sans-serif;
}

h1, h2, h3, h4, h5, h6 {
  font-family: "Minion Pro", "Georgia", serif;
}


    .hero {
      position: relative;
      background-color: rgba(0,43,83,1);
      color: white;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      overflow: hidden;
      flex-direction: column;
      padding: 0 20px;
    }


    .hero img.logo {
      max-height: 160px;
      margin-bottom: 20px;
      z-index: 2;
    }
    .hero::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.55);
      z-index: 1;
    }
    .hero > .container {
      position: relative;
      z-index: 2;
    }
    .hero h1 {
      font-size: 3rem;
      font-weight: 700;
    }
    .hero p {
      font-size: 1.35rem;
    }

    .card {
      border: none;
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease-in-out;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card-img-top {
      height: 180px;
      object-fit: cover;
      border-top-left-radius: 1rem;
      border-top-right-radius: 1rem;
    }

    .card-body {
      padding: 1.25rem;
      display: flex;
      flex-direction: column;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0;
    }

    .card-text.truncate-description {
      font-size: 0.95rem;
      color: #555;
      line-height: 1.4;
      margin-bottom: 0.75rem;
      min-height: 60px;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
    }

    .badge {
      font-size: 0.8rem;
      padding: 0.35em 0.65em;
      border-radius: 0.5rem;
    }

    .btn-sm {
      font-size: 0.85rem;
      padding: 0.45rem 0.75rem;
      border-radius: 0.4rem;
    }

    .mybtn {
      background-color: rgba(0,43,83,0.75);
      color: white;
      padding: 10px 25px;
    }

    .mybtn:hover {
      background-color: rgba(0,43,83,1);
    }
      .badge-primary,
  .btn-outline-primary {
    border-color: rgba(0,43,83,1);
    color: rgba(0,43,83,1);
  }

  .btn-outline-primary:hover {
    background-color: rgba(0,43,83,1);
    color: white;
  }

  .bg-primary {
    background-color: rgba(0,43,83,1) !important;
  }

  .text-primary {
    color: rgba(0,43,83,1) !important;
  }

  .btn-primary {
    background-color: rgba(0,43,83,1) !important;
    border-color: rgba(0,43,83,1) !important;
  }

  .btn-primary:hover {
    background-color: #001d3d !important;
    border-color: #001d3d !important;
  }
    .bg-lost {
  background-color: rgba(217, 84, 30) !important;
  color: white !important;
}

.bg-returned {
  background-color: rgba(172,212,241,1) !important;
  color: white !important;
}
      .bg-found{
          background-color: rgba(25,212,150,1) !important;
  color: white !important;
      }
    .leaderboard-btn {
  position: fixed;
  bottom: 24px;
  right: 24px;
  width: 56px;
  height: 56px;
  font-size: 1.25rem;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1055;
}

/* Custom Backgrounds for Top 3 */
.bg-warning-subtle {
  background-color: #fff9db !important;
}
.bg-secondary-subtle {
  background-color: #eaeaea !important;
}
.bg-bronze-subtle {
  background-color: #fbe4d5 !important;
}

.border-bronze {
  border-color: #cd7f32 !important;
}

.leaderboard-entry {
  transition: all 0.2s ease-in-out;
}

.leaderboard-entry:hover {
  transform: scale(1.01);
  background-color: rgba(0, 43, 83, 0.05);
}
.card-img-wrapper {
  position: relative;
  overflow: visible;
  height: 180px;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: #f9f9f9;
  overflow:hidden;
}

.card-img-top {
  height: 100%;
  width: auto;
  transition: transform 0.6s ease-in-out;
  transform: scale(1.2);
  transform-origin: center center;

}

.card:hover .card-img-top {
  transform: scale(1);
}

.bg-success {
  background-color: rgba(0,43,83,1) !important;
}
    .btn-success{
        background-color: rgba(0,43,83,1) !important;
    }



  </style>
</head>

<body class="bg-light">
  {% include 'nav.html' %}

<section class="hero text-white" id="vanta-hero">
  <div class="container" data-aos="fade-up" data-aos-duration="1000">
    <img src="{{ url_for('static', filename='dolphin_logo.webp') }}" alt="Logo" class="logo" data-aos="zoom-in" data-aos-delay="100">

    <p class="text-uppercase fw-semibold mb-1" data-aos="fade-up" data-aos-delay="150" style="letter-spacing: 1px; font-size: 0.95rem;">
      Help your community reunite with lost belongings
    </p>

    <h1 class="mb-3" data-aos="fade-up" data-aos-delay="200">Lost & Found</h1>
    <p class="mb-4" data-aos="fade-up" data-aos-delay="300">Chadwick International School</p>
    <a href="{{ url_for('report_lost') }}" class="btn mybtn" data-aos="fade-up" data-aos-delay="400" style="border:1px solid white;">Report Lost Item</a>
  </div>
</section>



<div class="container py-5" id="all-items">
    <div class="mb-4">
      <!-- Title Row -->
      <div class="d-flex align-items-center gap-2 mb-3">
        <img src="{{ url_for('static', filename='dolphin_logo.webp') }}" class="img-fluid" style="max-height: 50px;">
        <h2 class="mb-0 fw-bold text-primary">All Items</h2>
      </div>

      <!-- Filter/Search/Sort Row -->
      <div class="d-flex flex-column flex-md-row gap-3 align-items-stretch justify-content-start">
        <div class="input-group shadow-sm">
          <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
          <input type="text" id="searchInput" class="form-control" placeholder="Search by title or reporter">
        </div>

        <div class="input-group shadow-sm">
          <label class="input-group-text bg-white" for="statusFilter"><i class="bi bi-funnel-fill"></i></label>
          <select id="statusFilter" class="form-select">
            <option value="all">All Status</option>
            <option value="lost">Lost</option>
            <option value="returned">Returned</option>
          </select>
        </div>

        <div class="input-group shadow-sm">
          <label class="input-group-text bg-white" for="sortSelect"><i class="bi bi-sort-alpha-down"></i></label>
            <select id="sortSelect" class="form-select">
              <option value="default">Sort By</option>
              <option value="latest">History (latest)</option>
              <option value="oldest">History (oldest)</option>
              <option value="name">Name (A-Z)</option>
            </select>

        </div>
      </div>
    </div>


    <div class="row grid" id="itemsContainer">
      {% for item in items %}
      <div class="col-md-4 mb-4 grid-item"
           data-status="{{ 'returned' if item.returned else 'lost' }}"
           data-title="{{ item.title|lower }}"
           data-owner="{{ item.owner|lower }}"
           data-date="{{ item.lost_date}}">

        <div class="card {% if item.returned %}border-success{% endif %}">
          {% if session.get('username') == 'testtest' %}
  <form action="{{ url_for('delete_item', item_id=item.key) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this item?');"
        style="position: absolute; top: 10px; right: 10px; z-index: 5;">
    <button type="submit" class="btn btn-sm btn-danger" title="Delete Item">
      <i class="bi bi-trash-fill"></i>
    </button>
  </form>
{% endif %}

<div class="card-img-wrapper">
  <img src="{{ url_for('static', filename='uploads/' + item.image) }}" class="card-img-top" alt="Item Image">
</div>

          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="card-title">{{ item.title }}</h5>
<span class="badge
  {% if item.returned == true %}bg-returned
  {% elif item.status == 'found' %}bg-found
  {% else %}bg-lost{% endif %}">
  {% if item.returned == true %}
    <i class="bi bi-check-circle-fill me-1"></i>Returned
      {% elif item.status == 'found' %}
    <i class="bi bi-bell"></i> Found
  {% else %}
    <i class="bi bi-question-circle-fill me-1"></i>Lost
  {% endif %}
</span>

            </div>

            <p class="card-text truncate-description">{{ item.description[:50] }}...</p>
            <div class="d-flex justify-content-between align-items-center mt-auto flex-wrap gap-2">

              <p class="text-muted small mb-0">
                <i class="bi bi-calendar-event me-1"></i> {{ item.lost_date }} <br>
                {% if item.returned %}Originally{% else %}Reported{% endif %} by {{ item.owner }}
              </p>
              <div class="d-flex gap-2">

                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modal{{ loop.index }}">
                  <i class="bi bi-info-circle me-1"></i> Details
                </button>

              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal -->
      <div class="modal fade" id="modal{{ loop.index }}" tabindex="-1" aria-labelledby="modalLabel{{ loop.index }}" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalLabel{{ loop.index }}">{{ item.title }}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
<div class="modal-body">
  <img src="{{ url_for('static', filename='uploads/' + item.image) }}" class="img-fluid rounded mb-3 shadow-sm" alt="Item Image">

  <div class="mb-3">
    <h6 class="fw-bold text-primary">Description</h6>
    <p>{{ item.description }}</p>
  </div>

  <div class="mb-3">
    <h6 class="fw-bold text-primary">Owner</h6>
    <p class="mb-1"><i class="bi bi-person-circle me-1"></i>{{ item.owner }}</p>
  </div>

  <div class="mb-4">
    <h6 class="fw-bold text-primary">Status</h6>
<span class="badge px-3 py-2 {% if item.returned %}bg-returned{% else %}bg-lost{% endif %}">
      {% if item.returned %}Returned{% else %}Lost{% endif %}
    </span>
  </div>

          {% if not item.returned and session.get('username') and session['username'] != item.owner %}
          <div class="border-top pt-3 mt-4">
            <h5 class="fw-semibold mb-3 text-primary"><i class="bi bi-envelope-paper-fill me-1"></i>Contact the Owner</h5>

            <form action="{{ url_for('contact_owner') }}" method="post">
              <input type="hidden" name="owner" value="{{ item.owner }}">
              <input type="hidden" name="item_title" value="{{ item.title }}">

              <div class="mb-2">
                <label for="name-{{ loop.index }}" class="form-label">Your Name</label>
                <input type="text" name="finder_name" class="form-control shadow-sm" id="name-{{ loop.index }}" required>
              </div>
              <div class="mb-2">
                <label for="grade-{{ loop.index }}" class="form-label">Your Grade</label>
                <input type="text" name="finder_grade" class="form-control shadow-sm" id="grade-{{ loop.index }}" required>
              </div>
              <div class="mb-2">
                <label for="contact-{{ loop.index }}" class="form-label">Contact Info (Email or Phone)</label>
                <input type="text" name="finder_contact" class="form-control shadow-sm" id="contact-{{ loop.index }}" required>
              </div>
              <div class="mb-3">
                <label for="message-{{ loop.index }}" class="form-label">Message</label>
                <textarea name="finder_message" class="form-control shadow-sm" id="message-{{ loop.index }}" rows="3" required></textarea>
              </div>

              <button type="submit" class="btn btn-primary w-100">
                <i class="bi bi-send-fill me-1"></i> Send Message
              </button>
            </form>
          </div>
          {% endif %}
        </div>

          </div>
        </div>
      </div>
      {% endfor %}

    </div>
<div id="pagination" class="mt-4 d-flex justify-content-center"></div>


    <!-- Success Modal -->
<div class="modal fade" id="messageSuccessModal" tabindex="-1" aria-labelledby="messageSuccessLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="messageSuccessLabel">Message Sent</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <p>Your message has been successfully sent to the item owner.</p>
        <p>Please wait for them to reach out to you using your contact info.</p>
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-success px-4" data-bs-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>

  </div>

<!--<button class="btn btn-primary shadow-lg rounded-circle leaderboard-btn" data-bs-toggle="modal" data-bs-target="#leaderboardModal" title="View Leaderboard">-->
<!--  <i class="bi bi-trophy-fill fs-4"></i>-->
<!--</button>-->
<!-- Leaderboard Modal -->
<!-- Leaderboard Modal -->
<div class="modal fade" id="leaderboardModal" tabindex="-1" aria-labelledby="leaderboardModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="leaderboardModalLabel"><i class="bi bi-trophy-fill me-2"></i>Points Leaderboard</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body px-4 pt-3 pb-4">
        {% for user, data in sorted_users %}
          <div class="d-flex justify-content-between align-items-center px-3 py-2 mb-2 rounded shadow-sm leaderboard-entry
                      border-start border-5
                      {% if loop.index == 1 %}bg-warning-subtle border-warning fw-bold
                      {% elif loop.index == 2 %}bg-secondary-subtle border-secondary fw-semibold
                      {% elif loop.index == 3 %}bg-bronze-subtle border-bronze fw-medium
                      {% else %}bg-white border-light-subtle{% endif %}">
            <div class="d-flex align-items-center gap-3">
              <span class="fs-5 fw-bold text-muted">#{{ loop.index }}</span>
              <span class="fs-6">{{ user }}</span>
            </div>
            <span class="badge bg-primary rounded-pill px-3">{{ data.points }} pts</span>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<!-- Return Success Modal -->
<div class="modal fade" id="returnSuccessModal" tabindex="-1" aria-labelledby="returnSuccessLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="returnSuccessLabel">Item Returned</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <p>Your item was successfully marked as returned and points have been added to your account.</p>
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-success px-4" data-bs-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>



  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.min.js"></script>
<script>
const iso = new Isotope('.grid', {
  itemSelector: '.grid-item',
  layoutMode: 'fitRows',
  getSortData: {
    name: '[data-title]',
    latest: function(itemElem) {
      const dateStr = itemElem.getAttribute('data-date');
      return dateStr ? Date.parse(dateStr) : 0;
    }
  },
  sortAscending: {
    name: true,
    latest: false
  }
});




  const searchInput = document.getElementById("searchInput");
  const statusFilter = document.getElementById("statusFilter");
  const sortSelect = document.getElementById("sortSelect");

  function filterIsotope() {
    const query = searchInput.value.toLowerCase();
    const status = statusFilter.value;

    iso.arrange({
      filter: function (itemElem) {
        const title = itemElem.getAttribute('data-title') || '';
        const owner = itemElem.getAttribute('data-owner') || '';
        const itemStatus = itemElem.getAttribute('data-status') || '';

        const matchesSearch = title.includes(query) || owner.includes(query);
        const matchesStatus = status === "all" || itemStatus === status;

        return matchesSearch && matchesStatus;
      }
    });
  }


  searchInput.addEventListener("input", filterIsotope);
  statusFilter.addEventListener("change", filterIsotope);
sortSelect.addEventListener("change", () => {
  let sortByValue = sortSelect.value;
  let ascending = true;

  if (sortByValue === "default") {
    sortByValue = "original-order";
  }
  if (sortByValue === "latest") {
    sortByValue = "latest";
    ascending = false; // Newest first
  }
  if (sortByValue === "oldest") {
    sortByValue = "latest";
    ascending = true; // Oldest first
  }
  if (sortByValue === "name") {
    sortByValue = "name";
    ascending = true;
  }

  iso.arrange({ sortBy: sortByValue, sortAscending: ascending });
//  filterIsotope();
});

</script>

{% with messages = get_flashed_messages() %}
  {% if 'message_sent' in messages %}
    <script>
      window.addEventListener('load', function() {
        const successModal = new bootstrap.Modal(document.getElementById('messageSuccessModal'));
        successModal.show();
      });
    </script>
  {% endif %}
{% endwith %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.waves.min.js"></script>

<script>
  VANTA.WAVES({
    el: "#vanta-hero",
    mouseControls: true,
    touchControls: true,
    minHeight: 200.00,
    minWidth: 200.00,
    scale: 1.0,
    scaleMobile: 1.0,
    color: 0x002b53,
    shininess: 30.0,
    waveHeight: 20.0,
    waveSpeed: 0.6,
    zoom: 0.85
  })
</script>
  <script>
const itemsPerPage = 6; // Set your desired items per page
let currentPage = 1;

function getFilteredItems() {
  return iso.getFilteredItemElements();
}


function showPage(page) {
  const filteredItems = getFilteredItems();
  const totalItems = filteredItems.length;
  const totalPages = Math.ceil(totalItems / itemsPerPage);
  currentPage = Math.min(Math.max(1, page), totalPages);

  // Hide all, show only items for this page
  filteredItems.forEach((item, i) => {
    item.style.display = (i >= (currentPage - 1) * itemsPerPage && i < currentPage * itemsPerPage) ? '' : 'none';
  });

  // --- Add this line ---
  iso.layout();

  // Build pagination controls
  let paginationHtml = '';
  if (totalPages > 1) {
    paginationHtml += `<ul class="pagination justify-content-center">`;
    paginationHtml += `<li class="page-item${currentPage === 1 ? ' disabled' : ''}"><a class="page-link" href="#" data-page="${currentPage - 1}">Previous</a></li>`;
    for (let p = 1; p <= totalPages; p++) {
      paginationHtml += `<li class="page-item${p === currentPage ? ' active' : ''}"><a class="page-link" href="#" data-page="${p}">${p}</a></li>`;
    }
    paginationHtml += `<li class="page-item${currentPage === totalPages ? ' disabled' : ''}"><a class="page-link" href="#" data-page="${currentPage + 1}">Next</a></li>`;
    paginationHtml += `</ul>`;
  }
  document.getElementById('pagination').innerHTML = paginationHtml;

  // Handle click events
  document.querySelectorAll('#pagination .page-link').forEach(link => {
    link.onclick = function(e) {
      e.preventDefault();
      const targetPage = Number(this.getAttribute('data-page'));
      if (targetPage >= 1 && targetPage <= totalPages) showPage(targetPage);
    };
  });
}


// Hook pagination to Isotope filtering/sorting
function updatePagination() {
  showPage(1); // Reset to page 1 on filter/sort change
}
function filterAndPaginate() {
  const query = searchInput.value.toLowerCase();
  const status = statusFilter.value;

  iso.arrange({
    filter: function (itemElem) {
      const title = itemElem.getAttribute('data-title') || '';
      const owner = itemElem.getAttribute('data-owner') || '';
      const itemStatus = itemElem.getAttribute('data-status') || '';

      const matchesSearch = title.includes(query) || owner.includes(query);
      const matchesStatus = status === "all" || itemStatus === status;

      return matchesSearch && matchesStatus;
    }
  });

  // Trigger pagination update after filtering
  showPage(1);
}

searchInput.addEventListener("input", filterAndPaginate);
statusFilter.addEventListener("change", filterAndPaginate);
sortSelect.addEventListener("change", () => {
  let sortByValue = sortSelect.value;
  let ascending = true;

  if (sortByValue === "default") {
    sortByValue = "original-order";
  } else if (sortByValue === "latest") {
    sortByValue = "latest";
    ascending = false;
  } else if (sortByValue === "oldest") {
    sortByValue = "latest";
    ascending = true;
  } else if (sortByValue === "name") {
    sortByValue = "name";
    ascending = true;
  }

  iso.arrange({
    sortBy: sortByValue,
    sortAscending: ascending,
  });

  showPage(1);  // Update pagination after sorting
});


// After Isotope arrange, re-run pagination
iso.on('arrangeComplete', updatePagination);

// On initial load
document.addEventListener('DOMContentLoaded', function() {
  updatePagination();
});

</script>

<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>
  AOS.init({
    duration: 1000
  });
</script>
{% with messages = get_flashed_messages() %}
  {% for msg in messages %}
    <script>
      window.addEventListener('load', function () {
        const successText = {{ msg|tojson }};
        if (successText.includes("marked as returned")) {
          const modal = new bootstrap.Modal(document.getElementById('returnSuccessModal'));
          modal.show();
        } else if (successText.includes("successfully sent to the item owner")) {
          const modal = new bootstrap.Modal(document.getElementById('messageSuccessModal'));
          modal.show();
        }
      });
    </script>
  {% endfor %}
{% endwith %}



</body>
</html>
<!-- END OF index.html -->
